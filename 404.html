<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>404 ‚Äì Cheesiest Corner of the Internet</title>
  <style>
    body {
      background: #fffceb;
      font-family: "Comic Sans MS", cursive, sans-serif;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 2.5em;
      color: #ff9900;
    }
    p {
      font-size: 1.2em;
      color: #444;
    }
    #gameCanvas {
      border: 2px solid #ff9900;
      background: #fff;
      display: none;
      margin: 20px auto;
    }
    #restartBtn {
      display: none;
      margin-top: 10px;
      padding: 8px 15px;
      font-size: 16px;
      border: none;
      background: #ff9900;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    #restartBtn:hover {
      background: #e68a00;
    }
    #cheeseCounter {
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 10px;
      display: none;
    }
    #secret {
      font-size: 14px;
      color: #fffceb;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>404 ‚Äì Welcome to the Cheesiest Corner of the Internet üßÄ</h1>
  <p>Looks like you took a wrong turn in Rat Town. <br> (But maybe... there‚Äôs a secret here.)</p>

  <!-- Secret start button -->
  <div id="secret">üêü</div>

  <!-- Cheese counter -->
  <div id="cheeseCounter">Cheese eaten: 0 üßÄ</div>

  <!-- Game canvas -->
  <canvas id="gameCanvas" width="300" height="300"></canvas>

  <!-- Restart button -->
  <button id="restartBtn">Restart</button>

  <!-- Munch sound -->
  <audio id="munchSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b6aeb6fa91.mp3?filename=biting-into-apple-7074.mp3" preload="auto"></audio>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const secretBtn = document.getElementById("secret");
    const restartBtn = document.getElementById("restartBtn");
    const cheeseCounter = document.getElementById("cheeseCounter");
    const munchSound = document.getElementById("munchSound");

    let box = 15;
    let snake, cheese, d, game, cheeseCount;

    // Rat emoji directions
    const ratEmojis = {
      "LEFT": "üêÄ",
      "RIGHT": "üêÅ",
      "UP": "üêÄ",
      "DOWN": "üêÅ"
    };

    function drawRat(x, y, direction) {
      ctx.font = box + "px Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(ratEmojis[direction], x + box/2, y + box/2);
    }

    function startGame() {
      snake = [{x: 9*box, y: 10*box}];
      cheese = {
        x: Math.floor(Math.random()* (canvas.width/box)) * box,
        y: Math.floor(Math.random()* (canvas.height/box)) * box
      };
      d = null;
      cheeseCount = 0;
      cheeseCounter.innerText = "Cheese eaten: 0 üßÄ";
      cheeseCounter.style.display = "block";
      restartBtn.style.display = "none";
      clearInterval(game);
      game = setInterval(draw, 150); // slowed back down
    }

    document.addEventListener("keydown", direction);
    document.addEventListener("touchstart", handleTouchStart, false);
    document.addEventListener("touchmove", handleTouchMove, false);

    let xDown = null;
    let yDown = null;

    function handleTouchStart(evt) {
      const firstTouch = evt.touches[0];
      xDown = firstTouch.clientX;
      yDown = firstTouch.clientY;
    }

    function handleTouchMove(evt) {
      if (!xDown || !yDown) {
        return;
      }
      let xUp = evt.touches[0].clientX;
      let yUp = evt.touches[0].clientY;

      let xDiff = xDown - xUp;
      let yDiff = yDown - yUp;

      if (Math.abs(xDiff) > Math.abs(yDiff)) {
        if (xDiff > 0 && d !== "RIGHT") {
          d = "LEFT";
        } else if (xDiff < 0 && d !== "LEFT") {
          d = "RIGHT";
        }
      } else {
        if (yDiff > 0 && d !== "DOWN") {
          d = "UP";
        } else if (yDiff < 0 && d !== "UP") {
          d = "DOWN";
        }
      }
      xDown = null;
      yDown = null;
    }

    function direction(event) {
      if (event.keyCode === 37 && d !== "RIGHT") {
        d = "LEFT";
      } else if (event.keyCode === 38 && d !== "DOWN") {
        d = "UP";
      } else if (event.keyCode === 39 && d !== "LEFT") {
        d = "RIGHT";
      } else if (event.keyCode === 40 && d !== "UP") {
        d = "DOWN";
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw snake
      for (let i = 0; i < snake.length; i++) {
        drawRat(snake[i].x, snake[i].y, d || "RIGHT");
      }

      // Draw cheese
      ctx.fillText("üßÄ", cheese.x + box/2, cheese.y + box/2);

      let snakeX = snake[0].x;
      let snakeY = snake[0].y;

      if (d === "LEFT") snakeX -= box;
      if (d === "UP") snakeY -= box;
      if (d === "RIGHT") snakeX += box;
      if (d === "DOWN")
